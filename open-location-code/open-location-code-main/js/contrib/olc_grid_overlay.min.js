!function(i,t){"function"==typeof define&&define.amd?define(["b"],function(e){return i.returnExportsGlobal=t(e)}):"object"==typeof module&&module.exports?module.exports=t(require("b")):i.OLCGridOverlay=t()}(this,function(){function i(i){i=i||{},"undefined"!=typeof i.map&&this.setMap(map),this._minorGridDisplay=!0,"boolean"==typeof i.minorGridDisplay&&(this._minorGridDisplay=i.minorGridDisplay),this._minorLabelDisplay=!0,"boolean"==typeof i.minorLabelDisplay&&(this._minorLabelDisplay=i.minorLabelDisplay),this._roadmap={gridColor:"#7BAAF7",labelClass:"olc_overlay_text",majorStroke:2,majorOpacity:.5,minorStroke:1,minorOpacity:.2},this._satellite={gridColor:"#7BAAF7",labelClass:"olc_overlay_text",majorStroke:2,majorOpacity:.5,minorStroke:1,minorOpacity:.4},"string"==typeof i.roadMapColor&&(this._roadmap.gridColor=i.roadMapColor),"string"==typeof i.roadMapLabelClass&&(this._roadmap.labelClass=i.roadMapLabelClass),"string"==typeof i.satelliteMapColor&&(this._satellite.gridColor=i.satelliteMapColor),"string"==typeof i.satelliteMapLabelClass&&(this._satellite.labelClass=i.satelliteMapLabelClass),this._gridSettings=this._roadmap,this._gridLines=[],this._listeners=[],this._OLC_ALPHABET="23456789CFGHJMPQRVWX",this._OLC_LABEL_CLASSNAME="__olc_overlay_label__",this._gridBounds={latLo:0,lngLo:0,latHi:0,lngHi:0},this._majorGridSizeDeg=0,this._majorGridZoomLevels=[{zoom:6,grid:20},{zoom:10,grid:1},{zoom:14,grid:.05},{zoom:32,grid:.0025}],this._labelFontSizes={cellLabelMinFontPx:16,cellLabelMaxFontPx:100,gridLabelMinFontPx:8,gridLabelMaxFontPx:24}}return i.prototype=new google.maps.OverlayView,i.prototype.onAdd=function(){function i(){s._clear(),s._draw()}function t(){s._clear()}function e(){s._clearLabels()}var s=this;this._draw(),this._listeners.push(google.maps.event.addListener(this.getMap(),"idle",i)),this._listeners.push(google.maps.event.addListener(this.getMap(),"maptypeid_changed",i)),this._listeners.push(google.maps.event.addListener(this.getMap(),"zoom_changed",t)),this._minorLabelDisplay&&this._listeners.push(google.maps.event.addListener(this.getMap(),"dragstart",e))},i.prototype.draw=function(){},i.prototype.onRemove=function(){this._clear();for(var i=0;i<this._listeners.length;i++)google.maps.event.removeListener(this._listeners[i])},i.prototype.hide=function(){this._clear()},i.prototype.show=function(){this._clear(),this._draw()},i.prototype._clear=function(){this._clearLines(),this._clearLabels()},i.prototype._clearLines=function(){try{for(var i=0;i<this._gridLines.length;i++)this._gridLines[i].setMap(null)}catch(t){}this._gridLines=[]},i.prototype._clearLabels=function(){for(var i=this.getPanes().overlayLayer.children,t=i.length,e=t-1;e>=0;e--)i[e].className.indexOf(this._OLC_LABEL_CLASSNAME)>-1&&i[e].parentNode.removeChild(i[e])},i.prototype._draw=function(){for(var i=0;i<this._majorGridZoomLevels.length;i++)if(this.getMap().getZoom()<=this._majorGridZoomLevels[i].zoom){this._majorGridSizeDeg=this._majorGridZoomLevels[i].grid;break}var t=this.getMap().getBounds(),e=t.getSouthWest(),s=t.getNorthEast();this._gridBounds.latLo=Math.floor((e.lat()+90)/this._majorGridSizeDeg)*this._majorGridSizeDeg-90,this._gridBounds.latLo=Math.max(this._gridBounds.latLo,-90),this._gridBounds.latHi=Math.ceil((s.lat()+90)/this._majorGridSizeDeg)*this._majorGridSizeDeg-90,this._gridBounds.latHi=Math.min(this._gridBounds.latHi,90),this._gridBounds.lngLo=Math.floor(e.lng()/this._majorGridSizeDeg)*this._majorGridSizeDeg,this._gridBounds.lngHi=Math.ceil(s.lng()/this._majorGridSizeDeg)*this._majorGridSizeDeg,this._gridBounds.lngLo>this._gridBounds.lngHi&&(this._gridBounds.lngHi=this._gridBounds.lngHi+360),this._gridSettings=this._roadmap;var o=this.getMap().getMapTypeId();(o===google.maps.MapTypeId.HYBRID||o===google.maps.MapTypeId.SATELLITE)&&(this._gridSettings=this._satellite),this._drawLines(this._majorGridSizeDeg,this._gridSettings.majorStroke,this._gridSettings.majorOpacity),this._labelOLCCells(),Math.abs(this._llToPixels(this.getMap().getCenter().lat(),0).y-this._llToPixels(this.getMap().getCenter().lat()+this._majorGridSizeDeg/20,0).y)<10||(this._minorGridDisplay&&this._drawLines(this._majorGridSizeDeg/20,this._gridSettings.minorStroke,this._gridSettings.minorOpacity),this._minorLabelDisplay&&this._labelGridRowsCols())},i.prototype._drawLines=function(i,t,e){for(var s=this._gridBounds.lngLo;s<this._gridBounds.lngHi;s+=i){var o=new google.maps.Polyline({path:[{lat:this._gridBounds.latLo,lng:s},{lat:this._gridBounds.latHi,lng:s}],strokeColor:this._gridSettings.gridColor,strokeWeight:t,strokeOpacity:e,clickable:!1,map:this.getMap()});this._gridLines.push(o)}for(var r=this._gridBounds.latLo;r<this._gridBounds.latHi;r+=i){var o=new google.maps.Polyline({path:[{lat:r,lng:-180},{lat:r,lng:0},{lat:r,lng:180}],strokeColor:this._gridSettings.gridColor,strokeWeight:t,strokeOpacity:e,clickable:!1,map:this.getMap()});this._gridLines.push(o)}},i.prototype._labelOLCCells=function(){for(var i=this._gridBounds.latLo;i<=this._gridBounds.latHi;i+=this._majorGridSizeDeg)for(var t=this._gridBounds.lngLo;t<=this._gridBounds.lngHi;t+=this._majorGridSizeDeg){var e=OpenLocationCode.encode(i+this._majorGridSizeDeg/2,t+this._majorGridSizeDeg/2),s=null,o=null;20==this._majorGridSizeDeg?o=e.substr(0,2):1==this._majorGridSizeDeg?o=e.substr(0,4):.05==this._majorGridSizeDeg?(o=e.substr(4,2),s=e.substr(0,4)):(o=e.substr(4,5),s=e.substr(0,4)),this._makeLabel(s,o,i,t,this._majorGridSizeDeg,this._gridSettings.labelClass,this._labelFontSizes.cellLabelMinFontPx,this._labelFontSizes.cellLabelMaxFontPx)}},i.prototype._labelGridRowsCols=function(){for(var i=this.getMap().getBounds(),t=i.getSouthWest().lng(),e=i.getNorthEast().lng()-this._majorGridSizeDeg/20,s=i.getSouthWest().lat(),o=i.getNorthEast().lat()-this._majorGridSizeDeg/20,r=0,a=this._gridBounds.latLo;a<=this._gridBounds.latHi;a+=this._majorGridSizeDeg/20,r++)Math.abs(a-s)<this._majorGridSizeDeg/20/2||Math.abs(a-o)<this._majorGridSizeDeg/20/2||(this._labelGrid(this._OLC_ALPHABET[r%20],a,t),this._labelGrid(this._OLC_ALPHABET[r%20],a,e));r=0;for(var l=this._gridBounds.lngLo;l<=this._gridBounds.lngHi;l+=this._majorGridSizeDeg/20,r++)Math.abs(l-t)<this._majorGridSizeDeg/20/2||Math.abs(l-e)<this._majorGridSizeDeg/20/2||(this._labelGrid(this._OLC_ALPHABET[r%20],s,l),this._labelGrid(this._OLC_ALPHABET[r%20],o,l))},i.prototype._labelGrid=function(i,t,e){this._makeLabel(null,i,t,e,this._majorGridSizeDeg/20,this._gridSettings.labelClass,this._labelFontSizes.gridLabelMinFontPx,this._labelFontSizes.gridLabelMaxFontPx)},i.prototype._makeLabel=function(i,t,e,s,o,r,a,l){if(null!==t){var n=this._llToPixels(e,s),h=this._llToPixels(e+o,s+o),g=Math.abs(h.y-n.y),d=Math.abs(h.x-n.x),_=n.x,p=n.y-g,m=document.createElement("DIV");m.className=r+" "+this._OLC_LABEL_CLASSNAME,m.style.position="absolute",m.style.left=_+"px",m.style.top=p+"px",m.style.width=d+"px",m.style.height=g+"px";var L="";if(null!==i){var u=Math.min(Math.round(t.length/i.length*100),75);L+='<span style="font-size: '+u+'%;">'+i+"<br/></span>"}L+="<span>"+t+"</span>",m.innerHTML=L;var y=Math.min(Math.max(d/t.length,a),l);m.style.fontSize=y+"px",this.getPanes().overlayLayer.appendChild(m)}},i.prototype._llToPixels=function(i,t){return this.getProjection().fromLatLngToDivPixel(new google.maps.LatLng({lat:i,lng:t}))},i});
